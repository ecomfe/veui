<template>
  <article class="veui-form-demo">
    <h1><code>&lt;veui-form&gt;</code></h1>
    <section>
      <h2>è¡¨å•è¾“å‡ºæ•°æ®å¯ä¸è¾“å…¥åˆ†ç¦»ï¼Œåšä¸­é—´è½¬æ¢</h2>
      <veui-form ref="form1">

        <veui-form-field label="æ˜µç§°" name="nickName">
          <veui-input v-model="storeData1.nickName"></veui-input>
          <p class="output">{{ outputData.nickName }}</p>
        </veui-form-field>

        <veui-form-field label="æ€§åˆ«" name="sex">
          <veui-select :options="storeData1.sexItems" v-model="storeData1.sex"></veui-select>
          <p class="output">{{ outputData.sex }}</p>
        </veui-form-field>

        <veui-form-field label="å©šå§»" name="married">
          <veui-radioboxgroup :items="storeData1.marryItems" v-model="storeData1.married"></veui-radioboxgroup>
          <p class="output">{{ outputData.married }}</p>
        </veui-form-field>

        <veui-form-field label="çˆ±å¥½" name="habit">
          <veui-checkboxgroup type="checkbox" :items="storeData1.habitItems" v-model="storeData1.habit"></veui-checkboxgroup>
          <p class="output">{{ outputData.habit }}</p>
        </veui-form-field>

        <veui-form-field label="ç”Ÿæ—¥" name="birthday">
          <veui-datepicker v-model="storeData1.birthday"></veui-datepicker>
          <p class="output">{{ outputData.birthday }}</p>
        </veui-form-field>

        <veui-form-field label="å¤´åƒ" name="avatar">
          <veui-uploader uploaderType="image"
            action="/upload"
            request-mode="xhr"
            ui="multiline vertical bottom-mask list-icon"
            :disabled="false"
            :max-count="1"
            :value="storeData1.avatar"
            :max-size="10"
            preview-image
            needButton
            extention-types="jpg,jpeg,png"></veui-uploader>
          <p class="output">{{ outputData.avatar }}</p>
        </veui-form-field>

        <div class="operation">
          <veui-button @click="() => this.$refs.form1.reset()">é‡ç½®</veui-button>
        </div>
      </veui-form>
    </section>
    <section>
      <h2>è¡Œå†…å¤šç»„ä»¶è¡¨å•</h2>
      <veui-form>

        <veui-form-fieldset class="two-name" label="æ˜µç§°" label-for="firstName" tip='ä½¿ç”¨ label-for="refName" æ¥å®ç° for'>
          <veui-form-field name="lastName">
            <veui-input placeholder="å§“" v-model="storeData2.lastName"></veui-input>
          </veui-form-field>

          <veui-form-field name="firstName">
            <veui-input ref="firstName" placeholder="å" v-model="storeData2.firstName"></veui-input>
          </veui-form-field>
        </veui-form-fieldset>

        <veui-form-fieldset label="ç”µè¯" label-for="telephone">
          <veui-form-field name="phoneType">
            <veui-select v-model="storeData2.phoneType" :options="storeData2.phoneTypeOptions"></veui-select>
          </veui-form-field>

          <veui-form-field name="phone">
            <veui-input ref="telephone" placeholder="å" v-model="storeData2.phone"></veui-input>
          </veui-form-field>
        </veui-form-fieldset>

        <veui-form-fieldset label="é¢„æœŸæ”¶å…¥" class="salary" tip="ä½¿ç”¨ <veui-span> æ¥æ’å…¥ä¸­é—´éç»„ä»¶å†…å®¹">
          <veui-form-field name="start">
            <veui-input v-model="storeData2.start"></veui-input>
          </veui-form-field>
          <veui-span>-</veui-span>
          <veui-form-field name="end">
            <veui-input v-model="storeData2.end"></veui-input>
          </veui-form-field>
          <veui-span>ä¸‡</veui-span>
        </veui-form-fieldset>
      </veui-form>
    </section>
    <section>
      <h2>è¡Œå†…è¡¨å•</h2>
      <veui-form ui="inline">

        <veui-form-fieldset class="left">
          <veui-form-field label="çŠ¶æ€" name="status">
            <veui-select v-model="storeData3.statusSelected" :options="storeData3.statusOptions"></veui-select>
          </veui-form-field>

          <veui-form-field label="æœç´¢é¡¹ç›®" name="searchType">
            <veui-select v-model="storeData3.searchTypeSelected" :options="storeData3.searchTypeOptions"></veui-select>
          </veui-form-field>
        </veui-form-fieldset>

        <veui-form-fieldset class="right">
          <veui-form-field name="searchContent">
            <veui-input placeholder="è¯·è¾“å…¥æœç´¢å†…å®¹"></veui-input>
          </veui-form-field>
          <veui-button ui="primary">æœç´¢</veui-button>
        </veui-form-fieldset>

      </veui-form>

      <veui-form ui="inline">

        <veui-form-fieldset class="left" ui="alt">
          <veui-form-field label="çŠ¶æ€" name="status">
            <veui-select ui="alt" v-model="storeData3.statusSelected" :options="storeData3.statusOptions"></veui-select>
          </veui-form-field>

          <veui-form-field label="æœç´¢é¡¹ç›®" name="searchType">
            <veui-select ui="alt" v-model="storeData3.searchTypeSelected" :options="storeData3.searchTypeOptions"></veui-select>
          </veui-form-field>
        </veui-form-fieldset>

        <veui-form-fieldset class="right" name="searchContent">
          <veui-form-field>
            <veui-input placeholder="è¯·è¾“å…¥æœç´¢å†…å®¹"></veui-input>
          </veui-form-field>
          <veui-button ui="primary">æœç´¢</veui-button>
        </veui-form-fieldset>

      </veui-form>
    </section>
    <section>
      <h2>è¡¨å•æç¤ºå’ŒéªŒè¯</h2>
      <veui-form ref="form2"
        @submit="submit"
        @invalid="handleInvalid"
        :validators="validators"
        :beforeValidate="beforeValidate"
        :afterValidate="afterValidate">

        <veui-form-field name="name1" rules="required" label="å§“å" tip="å¿…å¡«ï¼Œé»˜è®¤æäº¤æ—¶æ ¡éªŒ">
          <veui-input v-model="storeData4.name"></veui-input>
        </veui-form-field>

        <veui-form-field name="name2" :rules="dynamicNameRule" label="å§“åï¼ˆåŠ¨æ€ï¼‰" tip="bluræ—¶æ ¡éªŒå¿…å¡«">
          <veui-input placeholder="é•¿åº¦ä¸èƒ½çŸ­äº2" v-model="storeData4.name"></veui-input>
        </veui-form-field>

        <veui-form-field name="age1" rules="numeric required" label="å¹´é¾„">
          <veui-input placeholder="é”™è¯¯æç¤ºä¼˜å…ˆå‡ºåœ¨å³ä¾§" v-model="storeData4.age"></veui-input>
        </veui-form-field>

        <veui-form-field name="age2" :rules="dynamicAgeRule" label="å¹´é¾„ï¼ˆåŠ¨æ€ï¼‰" tip="change æ—¶æ ¡éªŒé•¿åº¦">
          <veui-input placeholder="é•¿åº¦ä¸èƒ½è¶…è¿‡3" v-model="storeData4.age"></veui-input>
        </veui-form-field>

        <veui-form-field name="desc" rules="required" label="ä»‹ç»">
          <veui-input rows="3" type="textarea" v-model="storeData4.desc"></veui-input>
        </veui-form-field>

        <veui-form-fieldset label="ç”µè¯" label-for="phone">
          <veui-form-field name="phoneType">
            <veui-select v-model="storeData2.phoneType" :options="storeData2.phoneTypeOptions"></veui-select>
          </veui-form-field>

          <veui-form-field name="phone" rules="numeric required">
            <veui-input ref="phone" v-model="storeData2.phone"></veui-input>
          </veui-form-field>
        </veui-form-fieldset>

        <veui-form-field name="habit" :rules="habitRule" label="çˆ±å¥½" tip="è‡³å°‘é€‰æ‹©ä¸‰ä¸ª">
          <veui-checkboxgroup type="checkbox" :items="storeData1.habitItems" v-model="storeData1.habit"></veui-checkboxgroup>
        </veui-form-field>

        <veui-form-fieldset label="é¢„æœŸæ”¶å…¥" class="salary" tip="è”åˆæ ¡éªŒï¼Œä¸‹é™å¿…é¡»å°äºä¸Šé™">
          <veui-form-field name="start" rules="numeric required" class="start-form-field">
            <veui-input v-model="storeData2.start"></veui-input>
          </veui-form-field>
          <veui-span>-</veui-span>
          <veui-form-field name="end" rules="numeric required">
            <veui-input v-model="storeData2.end"></veui-input>
          </veui-form-field>
          <veui-span>ä¸‡</veui-span>
        </veui-form-fieldset>

        <div class="operation">
          <veui-button ui="primary" ref="submitBtn" :loading="isValidating" type="submit">æäº¤</veui-button>
        </div>
      </veui-form>
    </section>
    <section>
      <h2>åŠ¨æ€è¡¨å•</h2>
      <veui-form
        @submit="submit"
        @invalid="handleInvalid"
        :validators="qindianValidator"
        :beforeValidate="beforeValidate"
        :afterValidate="afterValidate">

        <veui-form-field label="è´Ÿè´£äºº" name="qindian">
          <veui-input v-model="storeData5.qindian"></veui-input>
        </veui-form-field>

        <veui-form-fieldset v-for="(item, index) in storeData5.scheduleInfo">
          <veui-form-field :name="'projectName' + (index + 1)" :rules="requiredRule" :label="'é¡¹ç›®æ’æœŸ-' + (index + 1)">
            <veui-input placeholder="é¡¹ç›®åç§°" v-model="item.project"></veui-input>
          </veui-form-field>
          <veui-form-field :name="'schedule' + (index + 1)" :rules="requiredRule">
            <veui-datepicker v-model="item.range" range></veui-datepicker>
          </veui-form-field>
          <veui-button @click="dynamicDelete(index)">åˆ é™¤</veui-button>
        </veui-form-fieldset>

        <div class="operation">
          <veui-button ui="primary" ref="submitBtn" :loading="isValidating" type="submit">æäº¤</veui-button>
          <veui-button @click="dynamicAdd">æ–°å¢é¡¹ç›®åŠæ’æœŸ</veui-button>
        </div>
      </veui-form>
    </section>
  </article>
</template>

<script>
import Form from '@/components/Form'
import FieldSet from '@/components/FieldSet'
import Field from '@/components/Field'
import Span from '@/components/Span'
import Input from '@/components/Input'
import Button from '@/components/Button'
import DatePicker from '@/components/DatePicker'
import Uploader from '@/components/Uploader'
import Select from '@/components/Select'
import CheckBoxGroup from '@/components/CheckBoxGroup'
import RadioBoxGroup from '@/components/RadioBoxGroup'
import moment from 'moment'
import bus from '../bus'

export default {
  name: 'form',

  components: {
    'veui-span': Span,
    'veui-input': Input,
    'veui-button': Button,
    'veui-form': Form,
    'veui-form-fieldset': FieldSet,
    'veui-form-field': Field,
    'veui-datepicker': DatePicker,
    'veui-uploader': Uploader,
    'veui-select': Select,
    'veui-checkboxgroup': CheckBoxGroup,
    'veui-radioboxgroup': RadioBoxGroup
  },

  data () {
    return {
      storeData1: {
        nickName: 'æäº‘è…¾',
        sex: 'å¥³',
        married: false,
        marryItems: [
          {
            value: true, label: 'å·²å©š'
          },
          {
            value: false, label: 'æœªå©š'
          }
        ],
        sexItems: [
          {
            value: '-', label: 'ä¸å‘Šè¯‰ä½ '
          },
          {
            value: 'ç”·', label: 'ç”·'
          },
          {
            value: 'å¥³', label: 'å¥³'
          }
        ],
        habit: ['ğŸ¸'],
        habitItems: [
          {
            value: 'âš½ï¸', label: 'è¶³çƒ'
          },
          {
            value: 'ğŸ€', label: 'ç¯®çƒ'
          },
          {
            value: 'ğŸ¸', label: 'ç¾½æ¯›çƒ'
          },
          {
            value: 'ğŸ¾', label: 'ç½‘çƒ'
          }
        ],
        birthday: new Date(),
        avatar: [{ src: 'https://www.baidu.com/img/bd_logo1.png' }]
      },
      storeData2: {
        lastName: '',
        firstName: '',
        phone: '18888888888',
        phoneType: 'mobile',
        phoneTypeOptions: [
          {
            label: 'åº§æœº',
            value: 'phone'
          },
          {
            label: 'æ‰‹æœº',
            value: 'mobile'
          }
        ],
        start: null,
        end: null
      },
      storeData3: {
        statusSelected: 1,
        statusOptions: [
          {
            label: 'çŠ¶æ€1',
            value: 1
          },
          {
            label: 'çŠ¶æ€2',
            value: 2
          },
          {
            label: 'çŠ¶æ€3',
            value: 3
          },
          {
            label: 'çŠ¶æ€4',
            value: 4
          }
        ],
        searchTypeSelected: 1,
        searchTypeOptions: [
          {
            label: 'é¡¹ç›®1',
            value: 1
          },
          {
            label: 'é¡¹ç›®2',
            value: 2
          },
          {
            label: 'é¡¹ç›®3',
            value: 3
          },
          {
            label: 'é¡¹ç›®4',
            value: 4
          }
        ]
      },
      storeData4: {
        name: '',
        age: null,
        desc: ''
      },
      requiredRule: [
        {
          name: 'required',
          value: true,
          triggers: 'blur,input'
        }
      ],
      dynamicNameRule: [
        {
          name: 'required',
          value: true,
          triggers: 'blur,input'
        },
        {
          name: 'minLength',
          value: 2
        }
      ],
      dynamicAgeRule: [
        {
          name: 'numeric',
          value: true
        },
        {
          name: 'maxLength',
          value: 3,
          triggers: 'change'
        }
      ],
      habitRule: [
        {
          name: 'minLength',
          value: 3,
          errMsg: 'è‡³å°‘é€‰æ‹©ä¸‰ä¸ªçˆ±å¥½',
          triggers: 'change'
        }
      ],
      isValidating: false,
      validators: [
        {
          fields: 'start,end',
          handler (start, end) {
            if (start == null || end == null) {
              return true
            }

            if (parseInt(start, 10) >= parseInt(end, 10)) {
              return {
                start: 'ä¸‹é™å¿…é¡»å°äºä¸Šé™'
              }
            }
            return true
          },
          triggers: ['change', 'submit,input']
        },
        {
          fields: 'phone',
          handler (phone) {
            return new Promise(function (resolve, reject) {
              setTimeout(function () {
                if (phone === '18888888888') {
                  return reject({
                    phone: 'è¯¥æ‰‹æœºå·²è¢«æ³¨å†Œ'
                  })
                }
                return resolve()
              }, 3000)
            })
          }
        }
      ],
      beforeValidate () {
        bus.$emit('log', 'beforeValidate')
        this.isValidating = true
      },
      afterValidate () {
        bus.$emit('log', 'afterValidate')
        this.isValidating = false
      },
      storeData5: {
        qindian: 'Evan You',
        scheduleInfo: [
          {
            project: 'vuejs',
            range: [moment().toDate(), moment().add(3, 'month').toDate()]
          }
        ]
      },
      qindianValidator: [
        {
          fields: 'qindian,qindian',
          handler (qindian) {
            if (qindian !== 'Evan You') {
              return {
                qindian: 'è¯¥é¡¹ä¸ºé’¦ç‚¹é¡¹ï¼Œå°±åˆ«æ”¹äº†'
              }
            }
            return true
          },
          triggers: ['input', 'submit']
        }
      ]
    }
  },

  computed: {
    outputData () {
      let nickName = 'ğŸ‡¨ğŸ‡³ ' + this.storeData1.nickName || ''
      let married = this.storeData1.married ? 'ğŸ’' : 'ğŸ’¿'
      let sex = this.storeData1.sex !== '-' ? this.storeData1.sex === 'ç”·' ? 'ğŸ‘”' : 'ğŸ‘—' : 'ğŸ‘½'
      let habit = this.storeData1.habit.join(' ')
      let phone = 'ğŸ“ ' + this.storeData1.phone
      let birthdayObj = moment(this.storeData1.birthday)
      let birthday = birthdayObj.isValid() ? birthdayObj.format('YYYYå¹´MæœˆDæ—¥') : ''
      return {
        nickName,
        married,
        sex,
        habit,
        phone,
        birthday,
        avatar: this.storeData1.avatar[0].src
      }
    }
  },

  methods: {
    handleInvalid (e) {
      bus.$emit('log', 'handleInvalid', e)
      this.isValidating = false
    },
    submit (data, e) {
      bus.$emit('log', 'submit', data, e)
    },
    dynamicAdd () {
      this.storeData5.scheduleInfo.push({
        project: null,
        range: null
      })
    },
    dynamicDelete (index) {
      this.storeData5.scheduleInfo.splice(index, 1)
    }
  }
}
</script>

<style lang="less">
@import "../../src/styles/theme-default/lib.less";

.veui-form-demo {
  h2 {
    margin-bottom: 40px;
  }

  section + section {
    margin-top: 50px;
  }

  margin-bottom: 50px;

  .veui-form[ui~="inline"] + .veui-form[ui~="inline"] {
    margin-top: 30px;
  }

  .left {
    float: left;
  }

  .right {
    float: right;
  }

  .output {
    position: absolute;
    display: inline-block;
    left: 560px;
    line-height: 36px;
    margin: 0 0 0 50px;

    &::before {
      position: absolute;
      left: -80px;
      content: "â‡’";
      line-height: 32px;
      font-size: 30px;
      color: #999;
    }
  }

  .two-name {
    .veui-input {
      width: 75px;
    }
  }

  .salary {
    .veui-input {
      width: 67px;
    }
  }

  .veui-uploader-list-image li {
    margin: 0;
  }

  .start-form-field {
    .veui-form-field-error:first-of-type {
      overflow: hidden;
      text-overflow: ellipsis;
      width: 80px;
      white-space: nowrap;
    }
  }

  .operation {
    margin-top: 60px;
    margin-left: 120px;

    [class*="veui"] {
      margin-left: 10px;
    }

    [class*="veui"]:first-child {
      margin-left: 0;
    }
  }
}
</style>
