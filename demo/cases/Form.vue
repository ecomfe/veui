<template>
  <article class="veui-form-demo">
    <h1><code>&lt;veui-form&gt;</code></h1>
    <section>
      <h2>è¡¨å•è¾“å‡ºæ•°æ®å¯ä¸è¾“å…¥åˆ†ç¦»ï¼Œåšä¸­é—´è½¬æ¢</h2>
      <veui-form ref="form1" :form-data="outputData">

        <veui-form-row label="æ˜µç§°">
          <veui-form-value>
            <veui-input name="nickName" v-model="storeData1.nickName"></veui-input>
          </veui-form-value>
          <p class="output">{{ outputData.nickName }}</p>
        </veui-form-row>

        <veui-form-row label="æ€§åˆ«">
          <veui-form-value>
            <veui-radioboxgroup type="radiobox" :items="storeData1.sexItems" name="sex" v-model="storeData1.sex"></veui-radioboxgroup>
          </veui-form-value>
          <p class="output">{{ outputData.sex }}</p>
        </veui-form-row>

        <veui-form-row label="çˆ±å¥½">
          <veui-form-value>
            <veui-checkboxgroup type="checkbox" :items="storeData1.habitItems" name="habit" v-model="storeData1.habit"></veui-checkboxgroup>
          </veui-form-value>
          <p class="output">{{ outputData.habit }}</p>
        </veui-form-row>

        <veui-form-row label="ç”Ÿæ—¥">
          <veui-form-value>
            <veui-datepicker name="birthday" v-model="storeData1.birthday"></veui-datepicker>
          </veui-form-value>
          <p class="output">{{ outputData.birthday }}</p>
        </veui-form-row>

        <veui-form-row label="å¤´åƒ">
          <veui-form-value>
          <veui-uploader uploaderType="image"
            name="avatar"
            action="/upload"
            request-mode="xhr"
            ui="multiline horizontal bottom-mask list-icon"
            :disabled="false"
            :max-count="1"
            :value="storeData1.avatar"
            :max-size="10"
            preview-image
            needButton
            extention-types="jpg,jpeg,png"></veui-uploader>
          </veui-form-value>
          <p class="output">{{ outputData.avatar }}</p>
        </veui-form-row>

        <veui-form-row>
          <veui-button @click="() => this.$refs.form1.reset()">é‡ç½®</veui-button>
        </veui-form-row>
      </veui-form>
    </section>
    <section>
      <h2>è¡Œå†…å¤šç»„ä»¶è¡¨å•</h2>
      <veui-form>

        <veui-form-row class="two-name" label="æ˜µç§°" label-for="firstName" tip='ä½¿ç”¨ label-for="refName" æ¥å®ç° for'>
          <veui-form-value>
            <veui-input name="lastName" placeholder="å§“" v-model="storeData2.lastName"></veui-input>
          </veui-form-value>

          <veui-form-value>
            <veui-input name="firstName" ref="firstName" placeholder="å" v-model="storeData2.firstName"></veui-input>
          </veui-form-value>
        </veui-form-row>

        <veui-form-row label="ç”µè¯" label-for="phone">
          <veui-form-value>
            <veui-select name="phoneType" v-model="storeData2.phoneType" :options="storeData2.phoneTypeOptions"></veui-select>
          </veui-form-value>

          <veui-form-value>
            <veui-input name="phone" ref="phone" placeholder="å" v-model="storeData2.phone"></veui-input>
          </veui-form-value>
        </veui-form-row>

        <veui-form-row label="é¢„æœŸæ”¶å…¥" class="salary" tip="ä½¿ç”¨ .veui-span æ¥æ’å…¥ä¸­é—´éç»„ä»¶å†…å®¹">
          <veui-form-value>
            <veui-input name="start" v-model="storeData2.start"></veui-input>
          </veui-form-value>
          <span class="veui-span">-</span>
          <veui-form-value>
            <veui-input name="end" v-model="storeData2.end"></veui-input>
          </veui-form-value> ä¸‡
        </veui-form-row>
      </veui-form>
    </section>
    <section>
      <h2>è¡Œå†…è¡¨å•</h2>
      <veui-form ui="inline">

        <div class="left">
          <veui-form-row label="çŠ¶æ€">
            <veui-form-value>
              <veui-select name="status" v-model="storeData3.statusSelected" :options="storeData3.statusOptions"></veui-select>
            </veui-form-value>
          </veui-form-row>

          <veui-form-row label="æœç´¢é¡¹ç›®">
            <veui-form-value>
              <veui-select name="searchType" v-model="storeData3.searchTypeSelected" :options="storeData3.searchTypeOptions"></veui-select>
            </veui-form-value>
          </veui-form-row>
        </div>

        <div class="right">
          <veui-form-row>
            <veui-form-value>
              <veui-input name="searchContent" placeholder="è¯·è¾“å…¥æœç´¢å†…å®¹"></veui-input>
            </veui-form-value>
          </veui-form-row>
          <veui-form-row>
            <veui-button ui="primary">æœç´¢</veui-button>
          </veui-form-row>
        </div>

      </veui-form>

      <veui-form ui="inline">

        <fieldset class="left">
          <veui-form-row label="çŠ¶æ€">
            <veui-form-value>
              <veui-select ui="alt" name="status" v-model="storeData3.statusSelected" :options="storeData3.statusOptions"></veui-select>
            </veui-form-value>
          </veui-form-row>

          <veui-form-row label="æœç´¢é¡¹ç›®">
            <veui-form-value>
              <veui-select ui="alt" name="searchType" v-model="storeData3.searchTypeSelected" :options="storeData3.searchTypeOptions"></veui-select>
            </veui-form-value>
          </veui-form-row>
        </fieldset>

        <div class="right">
          <veui-form-row>
            <veui-form-value>
              <veui-input name="searchContent" placeholder="è¯·è¾“å…¥æœç´¢å†…å®¹"></veui-input>
            </veui-form-value>
          </veui-form-row>
          <veui-form-row>
            <veui-button ui="primary">æœç´¢</veui-button>
          </veui-form-row>
        </div>

      </veui-form>
    </section>
    <section>
      <h2>è¡¨å•æç¤ºå’ŒéªŒè¯</h2>
      <veui-form ref="form2" @submit="submit" @invalid="handleInvalid" :validators="validators" :afterValidate="afterValidate">

        <veui-form-row label="å§“å" tip="å¿…å¡«ï¼Œé»˜è®¤æäº¤æ—¶æ ¡éªŒ">
          <veui-form-value rules="required">
            <veui-input name="name1" v-model="storeData4.name"></veui-input>
          </veui-form-value>
        </veui-form-row>

        <veui-form-row label="å§“åï¼ˆåŠ¨æ€ï¼‰" tip="bluræ—¶æ ¡éªŒå¿…å¡«">
          <veui-form-value :rules="dynamicNameRule">
            <veui-input name="name2" placeholder="é•¿åº¦ä¸èƒ½çŸ­äº2" v-model="storeData4.name"></veui-input>
          </veui-form-value>
        </veui-form-row>

        <veui-form-row label="å¹´é¾„">
          <veui-form-value rules="numeric required">
            <veui-input name="age1" placeholder="é”™è¯¯æç¤ºä¼˜å…ˆå‡ºåœ¨å³ä¾§" v-model="storeData4.age"></veui-input>
          </veui-form-value>
        </veui-form-row>

        <veui-form-row label="å¹´é¾„ï¼ˆåŠ¨æ€ï¼‰" tip="change æ—¶æ ¡éªŒé•¿åº¦">
          <veui-form-value :rules="dynamicAgeRule">
            <veui-input name="age2" placeholder="é•¿åº¦ä¸èƒ½è¶…è¿‡3" v-model="storeData4.age"></veui-input>
          </veui-form-value>
        </veui-form-row>

        <veui-form-row label="ä»‹ç»">
          <veui-form-value rules="required">
            <veui-input name="desc" rows="3" type="textarea" v-model="storeData4.desc"></veui-input>
          </veui-form-value>
        </veui-form-row>

        <veui-form-row label="ç”µè¯" label-for="phone">
          <veui-form-value>
            <veui-select name="phoneType" v-model="storeData2.phoneType" :options="storeData2.phoneTypeOptions"></veui-select>
          </veui-form-value>

          <veui-form-value rules="numeric required">
            <veui-input name="phone" ref="phone" placeholder="å" v-model="storeData2.phone"></veui-input>
          </veui-form-value>
        </veui-form-row>

        <veui-form-row label="é¢„æœŸæ”¶å…¥" class="salary" tip="è”åˆæ ¡éªŒï¼Œä¸‹é™å¿…é¡»å°äºä¸Šé™">
          <veui-form-value rules="numeric required">
            <veui-input name="start" v-model="storeData2.start"></veui-input>
          </veui-form-value>
          <span class="veui-span">-</span>
          <veui-form-value rules="numeric required">
            <veui-input name="end" v-model="storeData2.end"></veui-input>
          </veui-form-value> ä¸‡
        </veui-form-row>

        <veui-form-row>
          <veui-button ui="primary" ref="submitBtn" @click="setLoading" :loading="isValidating" type="submit">æäº¤</veui-button>
        </veui-form-row>
      </veui-form>
    </section>
  </article>
</template>

<script>
import Form from '@/components/Form/Form'
import FormRow from '@/components/Form/Row'
import FormValue from '@/components/Form/Value'
import Input from '@/components/Input'
import Button from '@/components/Button'
import DatePicker from '@/components/DatePicker'
import Uploader from '@/components/Uploader'
import Select from '@/components/Select'
import CheckBoxGroup from '@/components/CheckBoxGroup'
import RadioBoxGroup from '@/components/RadioBoxGroup'
import moment from 'moment'
import bus from '../bus'

export default {
  name: 'form',

  components: {
    'veui-input': Input,
    'veui-button': Button,
    'veui-form': Form,
    'veui-form-row': FormRow,
    'veui-form-value': FormValue,
    'veui-datepicker': DatePicker,
    'veui-uploader': Uploader,
    'veui-select': Select,
    'veui-checkboxgroup': CheckBoxGroup,
    'veui-radioboxgroup': RadioBoxGroup
  },

  data () {
    return {
      storeData1: {
        nickName: 'æäº‘è…¾',
        sex: 'å¥³',
        sexItems: [
          {
            value: 'ç”·', label: 'ç”·'
          },
          {
            value: 'å¥³', label: 'å¥³'
          }
        ],
        habit: ['ğŸ¸'],
        habitItems: [
          {
            value: 'âš½ï¸', label: 'è¶³çƒ'
          },
          {
            value: 'ğŸ€', label: 'ç¯®çƒ'
          },
          {
            value: 'ğŸ¸', label: 'ç¾½æ¯›çƒ'
          },
          {
            value: 'ğŸ¾', label: 'ç½‘çƒ'
          }
        ],
        birthday: new Date(),
        avatar: [{ src: 'https://www.baidu.com/img/bd_logo1.png' }]
      },
      storeData2: {
        lastName: '',
        firstName: '',
        phone: '18888888888',
        phoneType: 'mobile',
        phoneTypeOptions: [
          {
            label: 'åº§æœº',
            value: 'phone'
          },
          {
            label: 'æ‰‹æœº',
            value: 'mobile'
          }
        ],
        start: null,
        end: null
      },
      storeData3: {
        statusSelected: 1,
        statusOptions: [
          {
            label: 'çŠ¶æ€1',
            value: 1
          },
          {
            label: 'çŠ¶æ€2',
            value: 2
          },
          {
            label: 'çŠ¶æ€3',
            value: 3
          },
          {
            label: 'çŠ¶æ€4',
            value: 4
          }
        ],
        searchTypeSelected: 1,
        searchTypeOptions: [
          {
            label: 'é¡¹ç›®1',
            value: 1
          },
          {
            label: 'é¡¹ç›®2',
            value: 2
          },
          {
            label: 'é¡¹ç›®3',
            value: 3
          },
          {
            label: 'é¡¹ç›®4',
            value: 4
          }
        ]
      },
      storeData4: {
        name: '',
        age: null,
        desc: ''
      },
      dynamicNameRule: [
        {
          name: 'required',
          value: true,
          trigger: 'blur'
        },
        {
          name: 'minLength',
          value: 2
        }
      ],
      dynamicAgeRule: [
        {
          name: 'numeric',
          value: true
        },
        {
          name: 'maxLength',
          value: 3,
          trigger: 'change'
        }
      ],
      isValidating: false,
      validators: {
        'start,end' (values, refs) {
          if (!values.start || !values.end) {
            return true
          }

          if (parseInt(values.start, 10) >= parseInt(values.end, 10)) {
            refs.start.setValidity('ä¸‹é™å¿…é¡»å°äºä¸Šé™')
            return false
          } else {
            refs.start.hideValidity() && refs.end.hideValidity()
            return true
          }
        },
        'phone' (values, refs) {
          return new Promise(function (resolve, reject) {
            setTimeout(function () {
              if (values.phone === '18888888888') {
                refs.phone.setValidity('è¯¥æ‰‹æœºå·²è¢«æ³¨å†Œ')
                return reject('è¯¥æ‰‹æœºå·²è¢«æ³¨å†Œ')
              } else {
                refs.phone.hideValidity()
                return resolve()
              }
            }, 3000)
          })
        }
      },
      afterValidate () {
        bus.$emit('log', 'afterValidate')
        this.$vnode.context.isValidating = false
      }
    }
  },

  computed: {
    outputData () {
      let nickName = 'ğŸ‡¨ğŸ‡³ ' + this.storeData1.nickName || ''
      let sex = this.storeData1.sex === 'ç”·' ? 'ğŸ‘”' : 'ğŸ‘—'
      let habit = this.storeData1.habit.join(' ')
      let phone = 'ğŸ“ ' + this.storeData1.phone
      let birthdayObj = moment(this.storeData1.birthday)
      let birthday = birthdayObj.isValid() ? birthdayObj.format('YYYYå¹´MæœˆDæ—¥') : ''
      return {
        nickName,
        sex,
        habit,
        phone,
        birthday,
        avatar: this.storeData1.avatar[0].src
      }
    }
  },

  methods: {
    setLoading (e) {
      this.isValidating = true
      // TODO: éœ€è¦ BUTTON ä¿®æ”¹
      this.$refs.form2._handleSubmit()
    },
    handleInvalid (e) {
      bus.$emit('log', 'handleInvalid', e)
      this.isValidating = false
    },
    submit (data, e) {
      bus.$emit('log', 'submit', data, e)
    }
  }
}
</script>

<style lang="less">
@import "../../src/styles/theme-default/lib.less";

.veui-form-demo {
  h2 {
    margin-bottom: 40px;
  }

  section + section {
    margin-top: 50px;
  }

  margin-bottom: 50px;

  .veui-form[ui~="inline"] + .veui-form[ui~="inline"] {
    margin-top: 30px;
  }

  .left {
    float: left;
  }

  .right {
    float: right;
  }

  .output {
    position: absolute;
    display: inline-block;
    left: 560px;
    line-height: 36px;
    margin: 0 0 0 50px;

    &::before {
      position: absolute;
      left: -80px;
      content: "â‡’";
      line-height: 32px;
      font-size: 30px;
      color: #999;
    }
  }

  .two-name {
    .veui-input {
      width: 75px;
    }
  }

  .salary {
    .veui-input {
      width: 67px;
    }
  }

  .veui-uploader-list-image li {
    margin: 0;
  }
}
</style>
