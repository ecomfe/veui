<template>
  <veui-overlay :open="true" overlay-class="veui-toast-list" :priority="priority">
    <template v-for="message in messages">
      <veui-toast v-bind="message"
        :key="message.__message_id__"
        @close="remove(message)">
      </veui-toast>
    </template>
  </veui-overlay>
</template>

<script>
import Overlay from './Overlay'
import Toast from './Toast'
import { assign, findIndex, uniqueId } from 'lodash'
import { config } from '../managers'

config.defaults({
  'toast.priority': 101
})

export default {
  name: 'toast-list',
  components: {
    'veui-overlay': Overlay,
    'veui-toast': Toast
  },
  data () {
    return {
      messages: [],
      priority: config.get('toast.priority')
    }
  },
  methods: {
    add (message) {
      this.messages.unshift(assign({}, message, {
        __message_id__: uniqueId('veui-toast-')
      }))
    },
    remove (message) {
      this.messages.splice(findIndex(this.messages, msg => {
        return msg.__message_id__ === message.__message_id__
      }), 1)
    }
  }
}
</script>

<style lang="less">
@import "../styles/theme-default/lib.less";
.veui-toast-list {
  .fixed(@veui-nav-bar-height + 15px, _, _, 50%);
  transform: translateX(-50%);
  background: none;

  .veui-toast {
    margin-bottom: 10px;

    &:last-child {
      margin-bottom: 0;
    }
  }
}
</style>
